.PHONY: perl clean $(SUBDIRS) 

all: $(OBJDIR) perl $(TARGETS)

$(OBJDIR):
	mkdir -p $(OBJDIR)

perl: perl/Makefile
	cd perl && make && cd ..

perl/Makefile:
	cd perl && perl Makefile.PL && cd ..

install: $(EXEC)
	cd perl && make install && cd ..
	$(INSTALL) -b $(EXEC) $(PREFIX)/sbin/$(EXEC)
	$(INSTALL) -b rspamc.pl $(PREFIX)/bin/rspamc
	$(INSTALL) -v $(EXEC).sh $(PREFIX)/etc/rc.d
	#$(INSTALL) -m0644 rspamd.8 $(MANPATH)/man8
	#$(INSTALL) -m0644 rspamd.conf.sample $(PREFIX)/etc
	$(MKDIR) -o $(RSPAMD_USER) -g $(RSPAMD_GROUP) /var/run/rspamd

clean: clean-subdirs perl/Makefile
	rm -f $(OBJDIR)/*.o $(EXEC) *core
	rm -fr $(OBJDIR)
	rm -f $(SRCDIR)/cfg_lex.c $(SRCDIR)/cfg_yacc.c $(SRCDIR)/cfg_yacc.h
	rm -f config.cache
	cd perl && make clean && cd ..

dist-clean: clean dist-clean-subdirs
	rm -f Makefile
	rm -f test/Makefile
	rm -f config.log
	rm -f $(SRCDIR)/md5.h $(SRCDIR)/md5.c $(SRCDIR)/queue.h $(SRCDIR)/config.h $(SRCDIR)/modules.c $(SRCDIR)/modules.h
	cd perl && rm -f Makefile.old && rm -f Makefile.PL && cd ..

creategroup:
	@echo "Create group $(RSPAMD_GROUP) before installing!" 

createuser:
	@echo "Create user $(RSPAMD_USER) before installing!" 
